<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Weekly Habit Tracker</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <h1>Weekly Habit Tracker</h1>
  
  
  <table id="habit-table">
    <thead>
      <tr>
        <th>Habit</th>
        <th>Sunday</th>
        <th>Monday</th>
        <th>Tuesday</th>
        <th>Wednesday</th>
        <th>Thursday</th>
        <th>Friday</th>
        <th>Saturday</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody>
      <!-- Habit rows will be added dynamically -->
    </tbody>
  </table>

  <div style="margin-top: 20px;">
    <button onclick="location.href='progress.html'">View Progress Summary</button>
  </div>

  <script>
    const tableBody = document.querySelector('#habit-table tbody');

    async function fetchHabits() {
      try {
        const res = await fetch("http://localhost:5000/habits");
        const data = await res.json();
        renderHabits(data);
      } catch (error) {
        console.error('Error fetching habits:', error);
      }
    }

    function renderHabits(habits) {
      tableBody.innerHTML = "";

    

      habits.forEach(habit => {
        const row = document.createElement("tr");

        const nameCell = document.createElement("td");
        nameCell.textContent = habit.name;
        row.appendChild(nameCell);

        for (let day = 0; day < 7; day++) {
          const cell = document.createElement("td");
          const isDone = habit.progress[day];

           

          cell.className = isDone ? 'done' : 'not-done';

          const doneBtn = document.createElement("button");
          doneBtn.textContent = "✔️";
          doneBtn.className = "done-btn";
          doneBtn.onclick = () => updateProgress(habit._id, day, true);

          const notDoneBtn = document.createElement("button");
          notDoneBtn.textContent = "❌";
          notDoneBtn.className = "not-done-btn";
          notDoneBtn.onclick = () => updateProgress(habit._id, day, false);

          cell.appendChild(doneBtn);
          cell.appendChild(notDoneBtn);
          row.appendChild(cell);
        }

        const deleteCell = document.createElement("td");
        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "🗑️";
        deleteBtn.className = "delete-btn";
        deleteBtn.onclick = () => deleteHabit(habit._id);
        deleteCell.appendChild(deleteBtn);
        row.appendChild(deleteCell);

        tableBody.appendChild(row);
      });
    }

    

    async function updateProgress(habitId, dayIndex, isDone) {
      try {
        await fetch(`http://localhost:5000/habits/${habitId}/update`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ dayIndex, isDone })
        });
        fetchHabits(); // Refresh the table
      } catch (error) {
        console.error("Failed to update progress:", error);
      }
    }
    
    async function deleteHabit(habitId) {
    const confirmDelete = confirm("Are you sure you want to delete this habit?");
    if (!confirmDelete) return;

  try {
    const response = await fetch(`http://localhost:5000/habits/delete/${habitId}`, {
      method: "DELETE"
    });

    const result = await response.json();
    if (response.ok) {
      alert(result.message);
      fetchHabits(); // refresh table
    } else {
      alert("Delete failed: " + result.message);
    }

  } catch (err) {
    console.error("Error deleting habit:", err);
    alert("Server error while deleting.");
  }
}
 


    // Initial load
    fetchHabits();
  </script>

</body>
</html>
